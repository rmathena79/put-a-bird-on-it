# put-a-bird-on-it
Project 3 for Data Analytics Boot Camp. Submitted October, 2024.

This project defines a database of bird sightings, an API for accessing that data, and a web site which plots sightings on an interactive map. Search / filter options are provided for dates and bird genus or species. There are also graphs showing when birds have been sighted and how the counts for category of birds (genus or species) relates to all sightings.


# Repo Contents
Functional Files:
* **prep-data.py**: Script to process raw data files from eBird, generating CSVs for import into SQL database
* **sql/schema.sql**: Table definitions for SQL database
* **flask/app.py**: Flask API implementation, providing structured access to the database
* **www/static/css/style.css**: Minimal CSS files, based on class exercises
* **www/static/js/logic.js**: My javascript implementation
* **www/index.html**: The web page
* **www/loading.gif**: A giant spinning spiral animation

Informative Files:
* **ComponentDiagram.png**: Diagram showing the main pieces of this system
* **ComponentDiagram.drawio**: Source for the component diagram, as generated by draw.io (https://app.diagrams.net)
* **sql/QuickDBD_ERD.png**: ERD of the database
* **sql/QuickDBD_ERD.txt**: Source for the ERD, as generated by QuickDBD (https://app.quickdatabasediagrams.com)


# Instructions

In addition to a standard "dev" environment from class, you'll need to install psycopg2 for sqlalchemy to connect to postgresql in the Flask App.

1. Acquire a snapshot of eBird's Basic Dataset (https://ebird.org/home). eBird provides a small sample database with registration, but for more complete access you must apply for permission.
1. Modify prep_data.py to refer to your database snapshot as a source. The main database file will be named something like "ebd_US-OR_202308_202408_relAug-2024.txt". Run the script and it should create a set of .CSV in the output directory.
1. Set up a SQL database and create tables with sql/schema.sql. I have been using Postgresql.
1. Import your generated CSVs into their corresponding tables.
1. Create a flask/credentials.py file so the Flask API can connect to your database. This is an example:

        SERVER = "localhost"
        PORT = 5432
        USER = "postgres"
        PASSWORD = "thisisnotmypassword"
        DATABASE = "ebird_board"
        
1. Launch the Flask API, generally by going to the flask directory in your terminal and running either "python app.py" or "flask run". Note I have only been running it in development mode.
1. Create a www/static/address.js file so the web page knows where to connect to the Flask API. This is an example:

        let baseURL = "http://127.0.0.1:5000/api/v1.0";

1. Launch a web server using the www directory as it's root. I've just been using VSCode Live Server to launch index.html.


# Citations
Bird sighting data comes from eBird's (https://ebird.org/home) Basic Dataset. The code should work with any snapshot of their data, but I have been using subsets of this version:
* eBird Basic Dataset. Version: EBD_relApr-2022. Cornell Lab of Ornithology, Ithaca, New York. 9/26/2024.

Multiple elements link to pages from Animal Diversity Web (https://animaldiversity.org/) for detail about each taxonomic group.


# Development Notes

SIGNIFICANT PROBLEMS
* Layout is not remotely usable on mobile or small screens
* When an API call fails, the page doesn't handle it nicely
* Only tested with Chrome

LESSER PROBLEMS
* It's very beige.
* If you're looking at stats and resize the window, then switch to map, it gets messed up
* I suspect there are still some time zone problems lurking in the graph generation code

BIG IDEAS
* Link popups to species characteristics from Avonet
  * Use Avonet's name list as definitive, for scientific names
* Provide a way to show graphs of characteristics of selected species vs. the rest of its genus and all birds
* (Can't find a good source without scraping) Show pictures in popups

TODO FOR DEPLOYMENT
* [X] Confirm the database server is accessible locally
* [X] Clone the repo to the server
* [X] Upgrade Python
* [X] Get the Flask app running
* [X] Figure out deployment and update process
* [X] Modify the node.js web server to load the bird page, including relative paths for referenced files
* [X] Fix the search for genus+species; maybe the server isn't handling spaces right in the new environment
* [X] Get the web page to talk to the right address for API calls
* [X] Limit search size, show message when too big
* [X] Set up a default search that fits within that size limit
* [X] Break up the sightings CSV
* [X] Remove previous mini-import and import the full sightings database
* [X] Deployment script
* [ ] Change domain name

TODO
* Clean up graph generation code
* Make Enter work for applying filters
* Ideally eBird citation data should come from the database, since it could vary depending on dataset.

DEPLOYMENT (server specific, and still a little glitchy)
1. Get into cPanel
1. Open terminal
1. cd put-a-bird-on-it
1. git pull
1. cp -r flask/* ../flask.mathena-art.net/flaskapp
1. cp -r www/* ../aroot/static/birds
1. Restart Python (Flask) app if needed